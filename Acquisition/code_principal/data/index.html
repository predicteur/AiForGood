<html lang='fr'>
<head>
    <meta http-equiv='refresh' name='viewport' content='width=device-width'/>
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
</head>
<body style='background:url('https://zupimages.net/up/19/29/jblq.jpg') no-repeat center/100% 100%;'>
    <div class='container container-fluid px-5' style='min-height: 100%;'>
        <div class='row'>
            <div class='col-md-12'>
                <h3 class='text-center'>AlabintheAIR</h3>
                <br /><br />
                <table class='table text-center'>
                    <tbody>
                        <tr>
                            <td>PM2.5  </td>
                            <td id="pm25">10</td>
                        </tr>
                        <tr class='table-active'>
                            <td>PM10   </td>
                            <td id="pm10">20</td>
                        </tr>
                    </tbody>
                </table>
                <h3 class='text-center'>My FEELING</h3>
                <br /><br />
                      <div class='row'>
                          <div class='col-md-12'>
                              <a id="BIEN" class='btn btn-success btn-lg btn-block' style='padding-top:1%;padding-bottom:1%;' href="#">FRESH AIR</a>
                              <br /><br />
                              <a id="NORMAL" class='btn btn-primary btn-lg btn-block' style='padding-top:1%;padding-bottom:1%;' href="#">COMMON AIR</a>
                              <br /><br />
                              <a id="PASBIEN" class='btn btn-danger btn-lg btn-block' style='padding-top:1%;padding-bottom:1%;' href="#">STALE AIR</a>
                              <br />
                          </div>
                      </div>
                <h3 class='text-center'>Paramètres</h3>
                <br /><br />
                <div class='row'>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            mode de fonctionnement
                        </button>
                        <div class="dropdown-menu">
                            <a id="modeNormal" class="dropdown-item" href="#">Normal</a>
                            <div class="dropdown-divider"></div>
                            <a id="modeVeille" class="dropdown-item" href="#">Veille</a>
                            <div class="dropdown-divider"></div>
                            <a id="modeEconomie" class="dropdown-item" href="#">Economie</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var bien        = document.getElementById("BIEN");
        var normal      = document.getElementById("NORMAL");
        var pasbien     = document.getElementById("PASBIEN");
        var pm25        = document.getElementById("pm25");
        var pm10        = document.getElementById("pm10");
        var modeVeille  = document.getElementById("modeVeille");
        var modeEconomie= document.getElementById("modeEconomie");
        var modeNormal  = document.getElementById("modeNormal");
        var modeFonc    = "";
        var ressenti    = "";

        function updateData(lien="/mesures.json") {
            var xhr = new XMLHttpRequest();
            var parametre = { modeFonctionnement: "", ressenti:""};
            xhr.onreadystatechange = function() {
                if ((this.readyState == 4) & (this.status == 200 || this.status === 0) & (this.responseText != null)) {                             // Indicateur de l'avancement de l'appel AJAX == 4 => Données complètement accessibles
                    var response = JSON.parse(this.responseText);
                    pm25.textContent = response.PM25;
                    pm10.textContent = response.PM10;
                }
            }
            parametre.modeFonctionnement = modeFonc;
            parametre.ressenti = ressenti;
            lien = lien + "?parametre=" + JSON.stringify(parametre);
            xhr.open("GET",lien, true);        
            xhr.send();
        }
        bien.addEventListener           ('click', function() { console.log("click sur Bien");           ressenti = "bien";      });
        normal.addEventListener         ('click', function() { console.log("click sur normal");         ressenti = "normal";    });
        pasbien.addEventListener        ('click', function() { console.log("click sur pasbien");        ressenti = "pasbien";   });
        modeVeille.addEventListener     ('click', function() { console.log("click sur modeVeille");     modeFonc = "veille";    });
        modeNormal.addEventListener     ('click', function() { console.log("click sur modeNormal");     modeFonc = "normal";    });
        modeEconomie.addEventListener   ('click', function() { console.log("click sur modeEconomie");   modeFonc = "economie";  });
        window.setInterval(updateData, 10000);

    </script>
</body>
</html>


